<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>Admin</title>
<style>
body { background:#0f0f14; color:#f5f5f5; font-family:Arial; padding:1rem; }
h1 { color:#80f0d0; }
.box { background:#14141c; padding:1rem; border-radius:10px; margin-bottom:2rem; }
button { cursor:pointer; }
</style>
</head>
<body>

<h1>Admin Bereich</h1>
<button onclick="logout()">Logout</button>

<!-- ===================== -->
<!-- KLASSEN -->
<!-- ===================== -->
<div class="box">
<h2>Klassen</h2>

<input id="class-name" placeholder="Neue Klasse">
<button onclick="createClass()">Anlegen</button>

<div id="class-list"></div>
</div>

<!-- ===================== -->
<!-- MISSIONEN -->
<!-- ===================== -->
<div class="box">
<h2>Missionen</h2>

<form id="mission-form" enctype="multipart/form-data">
<input name="title" placeholder="Titel"><br><br>
<textarea name="description" placeholder="Beschreibung"></textarea><br><br>
<input name="xp_reward" type="number" placeholder="XP"><br><br>
<label><input type="checkbox" name="requires_upload"> Schüler müssen Bild hochladen</label><br><br>
<input type="file" name="image"><br><br>
<button type="submit">Mission anlegen</button>
</form>

<div id="mission-list"></div>
</div>

<script>
function logout() {
  location.href = "login.html";
}

// -------------------
// KLASSEN
// -------------------
async function loadClasses() {
  const r = await fetch("/api/admin/classes");
  const data = await r.json();

  const div = document.getElementById("class-list");
  div.innerHTML = "";

  data.classes.forEach(c => {
    div.innerHTML += `
      <div>
        ${c.name}
        <button onclick="deleteClass(${c.id})">Löschen</button>
      </div>`;
  });
}

async function createClass() {
  const name = document.getElementById("class-name").value;
  await fetch("/api/admin/classes", {
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body:JSON.stringify({name})
  });
  loadClasses();
}

async function deleteClass(id) {
  await fetch("/api/admin/classes/" + id, { method:"DELETE" });
  loadClasses();
}

// -------------------
// MISSIONEN
// -------------------
async function loadMissions() {
  const r = await fetch("/api/admin/missions");
  const list = await r.json();
  const div = document.getElementById("mission-list");

  div.innerHTML = "";
  list.forEach(m => {
    div.innerHTML += `
    <div style="margin-bottom:1rem;">
      <b>${m.title}</b> (${m.xp_reward} XP)
      <button onclick="deleteMission(${m.id})">Löschen</button><br>
      ${m.image_url ? `<img src="${m.image_url}" width="100">` : ""}
    </div>`;
  });
}

document.getElementById("mission-form").onsubmit = async (e) => {
  e.preventDefault();
  const fd = new FormData(e.target);
  await fetch("/api/admin/missions", {
    method:"POST",
    body: fd
  });
  loadMissions();
};

async function deleteMission(id) {
  await fetch("/api/admin/missions/" + id, { method:"DELETE" });
  loadMissions();
}

// -------------------
loadClasses();
loadMissions();
</script>
</body>
</html>
