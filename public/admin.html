<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <title>Temple of Logic – Admin</title>
  <style>
    body {
      background: #0f0f14;
      color: #f5f5f5;
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 1rem;
    }

    h1 {
      color: #80f0d0;
    }

    #classes-section {
      margin-top: 1.5rem;
      padding: 1rem;
      background: #14141c;
      border-radius: 10px;
      box-shadow: 0 0 10px #000;
    }

    #class-form {
      display: flex;
      gap: 0.5rem;
      margin-bottom: 1rem;
    }

    #new-class-name {
      flex: 1;
      padding: 0.5rem;
      background: #0f0f14;
      border: 1px solid #333;
      color: #fff;
    }

    #create-class-btn {
      background: #6a4df4;
      border: none;
      padding: 0.6rem 1rem;
      border-radius: 6px;
      color: white;
      cursor: pointer;
    }

    #classes-list {
      list-style: none;
      padding: 0;
      margin: 0;
    }

    .class-item {
      background: #1a1a24;
      padding: 0.5rem;
      margin-bottom: 0.4rem;
      border-radius: 6px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .badge-active {
      margin-left: 0.5rem;
      padding: 0.2rem 0.5rem;
      font-size: 0.75rem;
      background: #80f0d0;
      color: #000;
      border-radius: 999px;
    }

    .class-actions button {
      margin-left: 0.3rem;
      padding: 0.3rem 0.5rem;
      cursor: pointer;
      border-radius: 4px;
      border: none;
      font-size: 0.8rem;
    }

    .btn-select-class {
      background: #6a4df4;
      color: white;
    }

    .btn-delete-class {
      background: #3a1010;
      color: #ffb3b3;
    }

    #classes-error {
      color: #ff6b6b;
      margin-top: 0.5rem;
    }
  </style>
</head>
<body>

<h1>Admin – Klassenverwaltung</h1>

<section id="classes-section">
  <h2>Klassen</h2>

  <div id="class-form">
    <input id="new-class-name" placeholder="Neue Klasse (z. B. 7a)" />
    <button id="create-class-btn">Anlegen</button>
  </div>

  <ul id="classes-list"></ul>
  <p id="classes-error"></p>
</section>

<script>
  const listEl = document.getElementById("classes-list");
  const nameInput = document.getElementById("new-class-name");
  const errorEl = document.getElementById("classes-error");

  let activeClassId = null;

  async function loadClasses() {
    errorEl.textContent = "";
    const res = await fetch("/api/admin/classes");
    const data = await res.json();
    activeClassId = data.activeClassId;
    renderClasses(data.classes);
  }

  function renderClasses(classes) {
    listEl.innerHTML = "";

    classes.forEach((c) => {
      const li = document.createElement("li");
      li.className = "class-item";

      const name = document.createElement("div");
      name.textContent = c.name;

      if (c.id === activeClassId) {
        const badge = document.createElement("span");
        badge.className = "badge-active";
        badge.textContent = "aktiv";
        name.appendChild(badge);
      }

      const actions = document.createElement("div");
      actions.className = "class-actions";

      const btnSel = document.createElement("button");
      btnSel.textContent = "Auswählen";
      btnSel.className = "btn-select-class";
      btnSel.onclick = () => setActiveClass(c.id);

      const btnDel = document.createElement("button");
      btnDel.textContent = "Löschen";
      btnDel.className = "btn-delete-class";
      btnDel.onclick = () => deleteClass(c.id, c.name);

      actions.appendChild(btnSel);
      actions.appendChild(btnDel);

      li.appendChild(name);
      li.appendChild(actions);

      listEl.appendChild(li);
    });
  }

  async function createClass() {
    const name = nameInput.value.trim();
    if (!name) return;

    const res = await fetch("/api/admin/classes", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ name }),
    });

    const data = await res.json();
    if (!res.ok) {
      errorEl.textContent = data.error;
      return;
    }

    nameInput.value = "";
    loadClasses();
  }

  async function deleteClass(id, name) {
    if (!confirm(`Klasse "${name}" löschen?`)) return;

    const res = await fetch(`/api/admin/classes/${id}`, { method: "DELETE" });
    const data = await res.json();

    if (!res.ok) {
      errorEl.textContent = data.error;
      return;
    }

    loadClasses();
  }

  async function setActiveClass(id) {
    const res = await fetch("/api/admin/classes/active", {
      method: "POST",
      headers: {"Content-Type": "application/json"},
      body: JSON.stringify({ classId: id }),
    });

    const data = await res.json();
    if (!res.ok) {
      errorEl.textContent = data.error;
      return;
    }

    activeClassId = id;
    loadClasses();
  }

  document.getElementById("create-class-btn").onclick = createClass;

  loadClasses();
</script>

</body>
</html>
