<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8" />
    <title>Temple of Logic – Admin</title>
    <style>
        body {
            background: #11131a;
            color: white;
            font-family: Arial;
            margin: 0;
            padding: 0;
        }

        .section {
            padding: 20px;
            border-bottom: 1px solid #222;
        }

        h2 {
            color: #7a82ff;
        }

        input, button, select {
            padding: 8px;
            margin: 4px 0;
            width: 300px;
            border-radius: 6px;
            border: none;
        }

        button {
            cursor: pointer;
            background: #7a82ff;
            color: white;
        }

        button.delete {
            background: #661111;
        }

        img.preview {
            height: 90px;
            border-radius: 8px;
            margin-top: 6px;
        }

        .itembox {
            background: #161922;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 18px;
        }

        .logout {
            position: fixed;
            top: 10px;
            right: 10px;
            background: #444;
        }
    </style>
</head>
<body>

<button class="logout" onclick="logout()">Logout</button>

<div class="section">
    <h2>Missionen</h2>

    <input id="mission_title" placeholder="Titel" />
    <input id="mission_xp" placeholder="XP" type="number" />
    <input id="mission_img" type="file" accept="image/*" />
    <button onclick="createMission()">Mission anlegen</button>

    <div id="missions"></div>
</div>

<div class="section">
    <h2>Charaktere</h2>

    <input id="char_title" placeholder="Name" />
    <input id="char_img" type="file" accept="image/*" />
    <button onclick="createChar()">Charakter anlegen</button>

    <div id="chars"></div>
</div>

<div class="section">
    <h2>Bonuskarten</h2>

    <input id="card_title" placeholder="Titel" />
    <input id="card_text" placeholder="Beschreibung" />
    <input id="card_img" type="file" accept="image/*" />
    <button onclick="createCard()">Karte anlegen</button>

    <div id="cards"></div>
</div>

<div class="section">
    <h2>Level</h2>

    <input id="level_name" placeholder="Levelname (z.B. Lehrling)" />
    <input id="level_xp" placeholder="Benötigte XP" type="number" />
    <input id="level_reward" placeholder="Belohnung (optional)" />
    <button onclick="createLevel()">Level anlegen</button>

    <div id="levels"></div>
</div>

<script>
// -----------------------------------------------------
// Helper
// -----------------------------------------------------
const API = "https://a13-production.up.railway.app";

async function logout() {
    await fetch(API + "/api/auth/logout");
    window.location.href = "/";
}

function imgOrPlaceholder(url) {
    if (!url) return "<img class='preview' src='https://via.placeholder.com/100x100?text=No+Image'/>";
    return `<img class="preview" src="${url}" />`;
}

// -----------------------------------------------------
// MISSIONS
// -----------------------------------------------------
async function loadMissions() {
    const r = await fetch(API + "/api/admin/missions");
    if (!r.ok) return;
    const missions = await r.json();

    const box = document.getElementById("missions");
    box.innerHTML = "";

    missions.forEach(m => {
        box.innerHTML += `
            <div class="itembox">
                <b>${m.title}</b><br>
                XP: ${m.xp}<br>
                ${imgOrPlaceholder(m.image_url)}
                <br>
                <button class="delete" onclick="deleteMission(${m.id})">Löschen</button>
            </div>
        `;
    });
}

async function createMission() {
    const fd = new FormData();
    fd.append("title", document.getElementById("mission_title").value);
    fd.append("xp", document.getElementById("mission_xp").value);
    fd.append("image", document.getElementById("mission_img").files[0]);

    await fetch(API + "/api/admin/missions", {
        method: "POST",
        body: fd
    });

    loadMissions();
}

async function deleteMission(id) {
    await fetch(API + `/api/admin/missions/${id}`, { method: "DELETE" });
    loadMissions();
}

// -----------------------------------------------------
// CHARAKTERE
// -----------------------------------------------------
async function loadChars() {
    const r = await fetch(API + "/api/admin/chars");
    if (!r.ok) return;
    const chars = await r.json();

    const box = document.getElementById("chars");
    box.innerHTML = "";

    chars.forEach(c => {
        box.innerHTML += `
            <div class="itembox">
                <b>${c.title}</b><br>
                ${imgOrPlaceholder(c.image_url)}
                <br>
                <button class="delete" onclick="deleteChar(${c.id})">Löschen</button>
            </div>
        `;
    });
}

async function createChar() {
    const fd = new FormData();
    fd.append("title", document.getElementById("char_title").value);
    fd.append("image", document.getElementById("char_img").files[0]);

    await fetch(API + "/api/admin/chars", {
        method: "POST",
        body: fd
    });

    loadChars();
}

async function deleteChar(id) {
    await fetch(API + `/api/admin/chars/${id}`, { method: "DELETE" });
    loadChars();
}

// -----------------------------------------------------
// BONUSKARTEN
// -----------------------------------------------------
async function loadCards() {
    const r = await fetch(API + "/api/admin/cards");
    if (!r.ok) return;
    const cards = await r.json();

    const box = document.getElementById("cards");
    box.innerHTML = "";

    cards.forEach(c => {
        box.innerHTML += `
            <div class="itembox">
                <b>${c.title}</b><br>
                ${c.text}<br>
                ${imgOrPlaceholder(c.image_url)}
                <br>
                <button class="delete" onclick="deleteCard(${c.id})">Löschen</button>
            </div>
        `;
    });
}

async function createCard() {
    const fd = new FormData();
    fd.append("title", document.getElementById("card_title").value);
    fd.append("text", document.getElementById("card_text").value);
    fd.append("image", document.getElementById("card_img").files[0]);

    await fetch(API + "/api/admin/cards", {
        method: "POST",
        body: fd
    });

    loadCards();
}

async function deleteCard(id) {
    await fetch(API + `/api/admin/cards/${id}`, { method: "DELETE" });
    loadCards();
}

// -----------------------------------------------------
// LEVEL
// -----------------------------------------------------
async function loadLevels() {
    const r = await fetch(API + "/api/admin/levels");
    if (!r.ok) return;
    const levels = await r.json();

    const box = document.getElementById("levels");
    box.innerHTML = "";

    levels.forEach(l => {
        box.innerHTML += `
            <div class="itembox">
                <b>${l.name}</b><br>
                Benötigte XP: ${l.xp_required}<br>
                Belohnung: ${l.reward || "-"}<br>
                <button class="delete" onclick="deleteLevel(${l.id})">Löschen</button>
            </div>
        `;
    });
}

async function createLevel() {
    const body = {
        name: document.getElementById("level_name").value,
        xp_required: parseInt(document.getElementById("level_xp").value),
        reward: document.getElementById("level_reward").value
    };

    await fetch(API + "/api/admin/levels", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(body)
    });

    loadLevels();
}

async function deleteLevel(id) {
    await fetch(API + `/api/admin/levels/${id}`, { method: "DELETE" });
    loadLevels();
}

// -----------------------------------------------------
// INIT
// -----------------------------------------------------
loadMissions();
loadChars();
loadCards();
loadLevels();

</script>
</body>
</html>
